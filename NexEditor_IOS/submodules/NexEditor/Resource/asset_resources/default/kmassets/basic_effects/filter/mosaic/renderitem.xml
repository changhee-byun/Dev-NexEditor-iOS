<?xml version="1.0" encoding="utf-8"?>
<renderitem xmlns="http://schemas.kinemaster.com/km/renderitem" main="mainScript"
            id="com.nexstreaming.csd.overlayeffect"
            type="transition"
            intime="1500"
            outtime="0"
            intimefirst="1500"
            outtimelast="0"
            repeat="no"
            name="top_to_bottom">

	<shader name="filters_common_vertex" language="glsl" src="glsl/filters_common_vertex.glsl"/>
	<shader name="filters_mosaicall_fragment" language="glsl" src="glsl/filters_mosaicall_fragment.glsl"/>

	<parameter id="f_block_size" type="range" default="5" minvalue="1" maxvalue="20">
		<fieldlabel locale="en" value="@string/parameter_block_size" />
	</parameter>

	<program name="MAFx" language="glsl" fragmentShader="filters_mosaicall_fragment" vertexShader="filters_common_vertex" />
	<script name="mainScript" language="lua"><![CDATA[

		effect = {matrix = 0, left = 0, top = 0, right = 0, bottom = 0, alpha = 1}

		function setMatrixRECT(matrix, left, top, right, bottom, alpha)

			effect.matrix = matrix
			effect.left = left
			effect.top = top
			effect.right = right
			effect.bottom = bottom
			effect.alpha = alpha
		end

		function main()
			src_tex_id = kmGetScreenTexture(effect.matrix, effect.left, effect.top, effect.right, effect.bottom)
			w = kmGetTexWidth(src_tex_id)
			h = kmGetTexHeight(src_tex_id)
			res_tex = kmSetRenderToTexture(w, h)
			mvp_matrix = kmNewMatrix()
			kmLoadIdentity(mvp_matrix)
			MAFx.setMvpMatrix(mvp_matrix)
			MAFx.setTextureSize(w, h)
			MAFx.setBlockSize(range.f_block_size * 2, range.f_block_size * 2)
			MAFx.setSTexture0(src_tex_id)
			MAFx.drawRect(2, 2)

			kmSetRenderToDefault()
			kmSetRenderDest(1, 0)
			kmDrawSolid(effect.matrix, effect.left, effect.top, effect.right, effect.bottom)
			kmSetRenderDest(0, 1)
			kmDrawRegionTexBox(res_tex, effect.matrix, effect.left, effect.top, effect.right, effect.bottom, 0, effect.alpha)
			kmReleaseTexture(src_tex_id)
			kmSetRenderDest(0, 0)
		end

		]]></script>
</renderitem>