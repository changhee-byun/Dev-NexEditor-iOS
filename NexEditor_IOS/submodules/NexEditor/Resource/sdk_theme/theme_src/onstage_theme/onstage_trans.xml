<effect 
	id="com.nexstreaming.kinemaster.onstage.transition"
	name="On-Stage Transition"
	icon="theme_transition.png"
	theme="true"
	type="transition" 
	minduration="500" 
	maxduration="3000" 
	effectoffset="100" 
	effectoverlap="100">
	
	<clear color="0 0 0" />
		
	<texture id="video_out" video="1" />
	<texture id="video_in" video="2" />
	<texture id="star" src="star.png" />
	<texture id="starglow" src="starglow.png" />
	<texture id="curtain" src="onstage_curtain.png" wraps="repeat" />
	
	<animatedvalue id="rotate">
		<keyframe value="0" />
		<keyframe value="180" />
	</animatedvalue>
	
	<animatedvalue id="zoom" timingfunction="linear" >
		<keyframe value="-10.885" />
		<keyframe value="-30" timingfunction="ease-in-out"  />
		<keyframe value="-10.885" timingfunction="ease-in-out"  />
	</animatedvalue>
	
	<function id="glowfunc" type="simplexfractal" outputbias="0.5" outputscale="0.5" octaves="4" />
	<function id="swingfunc" type="simplexpure" inputscale="1 1 0.2" inputbias="30 20 10" outputscale="0.5" />
	<function id="swingfuncb" type="simplexpure" inputscale="1 1 0.18" inputbias="20 50 44" outputscale="30" />
	
	<projection type="perspective" aspect="1.77777" fov="45" top="1" near="1" far="130">
		<translate offset="0 0 @zoom">
					
			<scale x="4" y="1" type="texture">
				<translate offset="0 0 -45">
					<style alpha="0.6">
						<rect bounds="-60 30 60 0" texture="@curtain" />
					</style>
					<style alpha="0.2">
						<rect bounds="-60 -30 60 0" texture="@curtain" />
					</style>
				</translate>
			</scale>

			<translate offset="0 -4.5">
			<sequence id="s" type="linear" count="2" start="1 1" end="-1 0.3"> <scale x="1" y="@s.x"> <style alpha="@s.y">
				
					<sequence id="r" type="randmix" count="18" start="-75 1.5 -9 1.8" end="75 15 -43 2.5" seed="3472">
						<rotate axis="0 1 0" angle="@r.x">
							<translate offset="0 @r.y @r.z">
							
								<translate offset="0 100 0">
								<rotate axis="0 0 1" angle="@swingfunc(@r.x @r.y @t)">
								<translate offset="0 -100 0">
									
								<rotate axis="0 1 0" angle="@swingfuncb(@r.x @r.y @t)">
									<!--<rect bounds="-0.05 @r.w*0.6 0.05 100" texture="@string" />-->
									<style alpha="@glowfunc(@r.x @r.y @t)">
										<rect bounds="@r.w*-1 @r.w @r.w @r.w*-1" texture="@starglow" />
									</style>
									<!--<style alpha="0.5">
										<rect bounds="@r.w*-1 @r.w @r.w @r.w*-1" texture="@star" />
									</style>-->
								</rotate>
								
								</translate>
								</rotate>
								</translate>
								
							</translate>
						</rotate>
					</sequence>

			</style> </scale> </sequence>
			</translate>
			
			<rotate axis="0 1 0" angle="@rotate">
				<rect bounds="-8 -13.5 8 -4.5" color="0 0 0 1" />
				
				<cull face="front">
					<rect bounds="-8 4.5 8 -4.5" texture="@video_out" />
				</cull>
				<cull face="back">
					<style alpha="0.2">
						<rect bounds="-8 -13.5 8 -4.5" texture="@video_out" />
					</style>
				</cull>
				
				<scale type="texture" x="-1" y="1"><translate textureoffset="-1 0">
					<cull face="back">
						<rect bounds="-8 4.5 8 -4.5" texture="@video_in" />
					</cull>
					<cull face="front">
						<style alpha="0.2">
							<rect bounds="-8 -13.5 8 -4.5" texture="@video_in" />
						</style>
					</cull>
				</translate></scale>
			</rotate>
			
		</translate>
	</projection>	
		
</effect>
